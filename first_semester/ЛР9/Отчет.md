<img width="1244" height="690" alt="Снимок экрана 2025-12-07 185509" src="https://github.com/user-attachments/assets/10a1fb31-aea2-4323-a576-32993fd70a96" /><img width="1229" height="799" alt="Снимок экрана 2025-12-07 185458" src="https://github.com/user-attachments/assets/5ed84ef8-86b7-43fd-98fe-05c9d483209a" />Выполнил Рябков Александр, P3124

# Цель работы

Целью работы является:
- Реализация CRUD-операций для сущностей бизнес-логики приложения
- Освоение работы с базой данных SQLite через модуль `sqlite3`
- Изучение принципов первичных и внешних ключей и их роли в связях между таблицами
- Разделение приложения на компоненты в архитектуре MVC
- Реализация пользовательских подписок на валюты и отображение связанных данных
- Создание собственного роутера на основе GET-запросов
- Тестирование логики CRUD на базе `unittest.mock`

# Основные задачи

В ходе лабораторной работы были выполнены следующие задачи:

## 1. Реализация CRUD для сущности “Currency”

В таблице `currency` реализованы операции:
- **Create** — добавление новой валюты в базу SQLite
- **Read** — вывод списка всех валют
- **Update** — изменение курса валюты (с проверкой, что курс не отрицательный)
- **Delete** — удаление валюты по её `id`

Все запросы выполнены через **параметризованные SQL-выражения**, что исключает SQL-инъекции.

## 2. Работа с SQLite

Использована база данных SQLite в режиме 
Созданы таблицы:
- `user`
- `currency`
- `user_currency` (связующая через FOREIGN KEY)
    
В ходе работы продемонстрирована роль:

- **PRIMARY KEY** — обеспечивает уникальность сущности и упрощает CRUD
- **FOREIGN KEY** — задаёт связи между пользователем и валютой

# Контроллеры и архитектура MVC

Приложение структурировано согласно MVC:

- **Models** — классы `User`, `Currency`, `UserSubscription` и валидаторы.
- **Controllers** — `CurrencyController`, `DatabaseController`, логика подписок.
- **Views** — HTML-шаблоны (Jinja2) с таблицами валют и подписок.
- **Router** (`server.py`) — обработка маршрутов и GET-запросов.
    
Разделение ответственности строго соблюдено.

# Маршруты приложения и шаблоны

Реализованы маршруты:

|Маршрут|Назначение|
|---|---|
|`/`|Главная страница|
|`/author`|Информация об авторе|
|`/users`|Список пользователей, CRUD|
|`/user?id=...`|Профиль пользователя|
|`/currencies`|Таблица валют|
|`/currency/create`|Создание валюты|
|`/currency/update`|Обновление курса|
|`/currency/delete?id=...`|Удаление валюты|
|`/users?user=1&add=USD`|Подписка пользователя|
|`/users?user=1&delete=USD`|Удаление подписки|


# Работа с подписками пользователей
Интегрирован функционал ЛР8:
- пользователь может подписываться на валюты, хранящиеся в SQLite
- подгружается история курса за 90 дней
- рассчитывается процент изменения
- строятся графики с помощью Chart.js
- данные подписок отображаются в таблицах

# Пример работы с базой данных

Используются:
- параметризованные INSERT-запросы
- выборка валют по char_code
- массовая вставка через `executemany`

Пример:
```python
INSERT INTO currency(num_code, char_code, name, value, nominal)
VALUES (:num_code, :char_code, :name, :value, :nominal)
```


# Пример тестирования с unittest.mock

Для контроллера валют реализованы тесты:
- проверка чтения списка валют
- проверка вызова методов CRUD
- имитация БД через mock-объект



# Скриншоты работы приложения


1. Главная страница
<img width="1188" height="582" alt="Снимок экрана 2025-12-07 185423" src="https://github.com/user-attachments/assets/9b1e353c-a005-4aea-bd35-f8dc86db1d4a" />
2. Список валют
<img width="1193" height="732" alt="Снимок экрана 2025-12-07 185436" src="https://github.com/user-attachments/assets/59ab924f-b0ae-458e-9fe6-7a7ccf461f8f" />
3. Обновление курса валюты
<img width="1229" height="799" alt="Снимок экрана 2025-12-07 185458" src="https://github.com/user-attachments/assets/18b62d5b-ca68-47c4-aca7-5a8a9b1d699d" />
4. Удаление валюты
<img width="1244" height="690" alt="Снимок экрана 2025-12-07 185509" src="https://github.com/user-attachments/assets/edafe8f5-593e-4f50-a909-9c27160eb7b0" />
5. Страница пользователя и подписки
<img width="1231" height="964" alt="Снимок экрана 2025-12-07 185516" src="https://github.com/user-attachments/assets/94bfc646-e5f4-421e-98d3-322a9ba92630" />
<img width="1180" height="1270" alt="Снимок экрана 2025-12-07 185529" src="https://github.com/user-attachments/assets/38685e87-ef2c-4c27-9309-0f0a1b79c5f0" />


# Выводы
В результате выполнения лабораторной работы:
- освоены принципы MVC и корректное разделение кода
- реализован собственный мини-фреймворк: маршрутизация, рендеринг, контроллеры, модели
- выполнен полноценный CRUD на SQLite
- интегрирован функционал подписок
- реализованы тесты бизнес-логики
- закреплены навыки работы с SQL, HTML-шаблонами и обработкой запросов
    

Лабораторная работа полностью выполнена и соответствует требованиям.
